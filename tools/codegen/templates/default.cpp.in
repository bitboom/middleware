/*
 *  Copyright (c) 2014, Facebook, Inc.
 *  All rights reserved.
 *
 *  This source code is licensed under the BSD-style license found in the
 *  LICENSE file in the root directory of this source tree. An additional grant
 *  of patent rights can be found in the PATENTS file in the same directory.
 *
 */

/*
** This file is generated. Do not modify it manually!
*/

#include <osquery/events.h>
#include <osquery/tables.h>
#include <osquery/status.h>
#include <osquery/registry_factory.h>

namespace osquery {

/// BEGIN[GENTABLE]
namespace tables {
{% if class_name == "" %}\
osquery::QueryData {{function}}(QueryContext& request);
{% if function_update != "" %}\
osquery::Status {{function_update}}(Row& row);
{% endif %}\
{% else %}
class {{class_name}} {
 public:
  osquery::QueryData {{function}}(QueryContext& request);
{% if function_update != "" %}\
  osquery::Status {{function_update}}(Row& row);
{% endif %}\
};
{% endif %}\
}

class {{table_name_cc}}TablePlugin : public TablePlugin {
 private:
  TableColumns columns() const {
    return {
{% for column in schema %}\
     std::make_tuple("{{column.name}}", {{column.type.affinity}}_TYPE,\
     ColumnOptions::DEFAULT)\
{% if not loop.last %}, {% endif %}
{% endfor %}\
    };
  }

  TableRows generate(QueryContext& context) override {
{% if class_name != "" %}\
    if (EventFactory::exists("{{class_name}}")) {
      auto subscriber = EventFactory::getEventSubscriber("{{class_name}}");
      return subscriber->{{function}}(request);
    } else {
      return {};
    }
{% else %}\
    TableRows results = osquery::tableRowsFromQueryData(tables::{{function}}(context));
{% endif %}\
    return results;
  }

{% if function_update != "" %}\
  Status update(Row& row) {
    return tables::{{function_update}}(row);
  }
{% endif %}\
};


{% if attributes.utility %}
REGISTER_INTERNAL({{table_name_cc}}TablePlugin, "table", "{{table_name}}");
{% else %}
REGISTER({{table_name_cc}}TablePlugin, "table", "{{table_name}}");
{% endif %}
/// END[GENTABLE]

}
